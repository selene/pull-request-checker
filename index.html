<html>
<head>
  <title>PR Queue Checker</title>
  <script src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
  <style>
    form div {
      margin: 5px;
    }
    label {
      display: inline-block;
      width: 130px;
    }
    input[type=submit] {
      padding: 5px 15px;
      cursor:pointer;
      border-radius: 5px;
      width: 292px;
    }
    input[type=submit]#refresh {
      font-size: 18px;
    }
  </style>
</head>
<body>

  <h1>PR Queue Checker</h1>
  <form id="login">
    <div id="name_row"><label for="name">Github Username:</label> <input type="text" id="name" /></div>
    <div id="password_row"><label for="password">Password:</label> <input type="password" id="password" /></div>
    <div><input type="submit" id="submit" /><input type="submit" id="refresh" value="Refresh" style="display:none;" /></div>
  </form>
  <div id="results">
  </div>

<script type="text/javascript">
window.onload = (function(){

  $('#login').submit(function onLogin() {
    var userPulls = {};
    var repos = [/*fill in locally*/];
    var credentials = btoa($('#name').val() + ":" + $('#password').val());
    var finished = 0;
    repos.forEach(function getRepoPulls(repoName) {
      $('#results').html("Loading...")
      $.ajax({
        type: "GET",
        url: "https://api.github.com/repos/ThinkNear/" + repoName + "/pulls",
        dataType: 'json',
        beforeSend: function(xhr) {
          xhr.setRequestHeader("Authorization", "Basic " + credentials);
        },
        success: function(response) {
          response.forEach(function groupUserPulls(pull) {
            var assignee = pull.assignee;
            if (!assignee) { assignee = {login: "[Unassigned]"} }
            if (!userPulls[assignee.login]) { userPulls[assignee.login] = [] }
              userPulls[assignee.login].push({
                url: pull.html_url,
                name: pull.title,
                repo: pull.base.repo.name
              });
          });

          ++finished;
          if (finished == repos.length) {
            onAllReposFinished(userPulls);
          }
        }
      });

    });

    function onAllReposFinished(userPulls){
      var resultHtml = "";
      for (var u in userPulls) {
        pulls = userPulls[u];
        resultHtml += "<div>\n<h3>" + u + "</h3>\n<ul>"
        for (var i = 0; i < pulls.length; i++) {
          var pull = pulls[i];
          resultHtml += "<li><a href='" + pull.url + "'>" + pull.name + "</a> (" + pull.repo + ")</li>"
        }

        resultHtml += "</ul></div>\n"
      }
      $("#results").html(resultHtml);
      $('#name_row').hide();
      $('#password_row').hide();
      $('#submit').hide();
      $('#refresh').show();
    }

    return false;
  });
});

</script>
</body>
</html>
